@page "/detalhes/{id:int}"
@using Microsoft.AspNetCore.Components.Web
@rendermode Microsoft.AspNetCore.Components.Web.RenderMode.InteractiveServer
@using RCLComum.Models
@using RCLAPI.Services
@inject IProdutoService ProdutoService
@inject NavigationManager Nav

<div class="container mt-4">
    @if (produto == null) {
        <p><em>A carregar detalhes...</em></p>
    }
    else {
        <button class="btn btn-link ps-0" @onclick='() => Nav.NavigateTo("/catalogo")'>&larr; Voltar ao Catálogo</button>

        <div class="row mt-3">
            <div class="col-md-6">
                <div class="bg-light d-flex align-items-center justify-content-center" style="height: 400px; border-radius: 8px;">
                    <i class="bi bi-image text-muted" style="font-size: 4rem;"></i>
                </div>
            </div>

            <div class="col-md-6">
                <span class="badge bg-primary mb-2">@produto.CategoriaNome</span>
                <h2 class="display-5">@produto.Titulo</h2>
                <p class="text-muted small">Fornecido por: @produto.FornecedorNome</p>
                <hr />
                <h3 class="text-success">@produto.PrecoFinal.ToString("C")</h3>
                <p class="mt-4"><strong>Descrição:</strong></p>
                <p>@produto.Descricao</p>

                <div class="mt-4 p-3 border rounded @(produto.Stock > 0 ? "bg-light" : "bg-danger text-white")">
                    @if (produto.Stock > 0) {
                        <span>Em Stock: <strong>@produto.Stock unidades</strong></span>
                    }
                    else {
                        <span><strong>Esgotado Temporariamente</strong></span>
                    }
                </div>

                <button class="btn btn-primary btn-lg w-100 mt-4" disabled="@(produto.Stock <= 0)">
                    Adicionar ao Carrinho
                </button>
            </div>
        </div>
    }
</div>

@code {
    [Parameter] public int Id { get; set; }
    private ProdutoDTO? produto;

    protected override async Task OnInitializedAsync() {
        produto = await ProdutoService.GetProdutoById(Id);
    }
}